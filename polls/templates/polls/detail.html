{% extends 'polls/base.html' %} <!--kế thừa từ base.html-->
{% block title %} Review MV {% endblock %}
{% block detail %}
{% load static %}
 <!--Main Content-->

<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v7.0&appId=278584073151612&autoLogAppEvents=1" nonce="X5n6Utq0">
</script>
    <div class="container detail_content mt-3 mb-3">


        <div class="single_tile_Mv">
            {% if list_detail_product %}
                  {% csrf_token %}
                      <ul>
                        {% for item in list_detail_product.propertyimage_set.all %}
                             {% if forloop.counter == 1 %}
                                 <img class="first_img_intro img-fluid rounded" src="{{ item.product_img_detail.url }}" alt="{{item.id}}">
                             {% endif %}
                        {% endfor %}
                      </ul>
                  {% endif %}
            <div class="info_intro">
                  {% if list_detail_product %} <!--Tiêu đề chi tiết -->
                  {% csrf_token %}
                        {% for item in list_detail_product.propertytitle_set.all %}
                             <h3 class="Title_review_detail">{{ item.TitleName_detail }}</h3>
                        {% endfor %}
                  {% endif %}

                   {% if list_detail_product %} <!--Tiêu đề chi tiết -->
                  {% csrf_token %}
                        {% for item in list_detail_product.propertysinger_set.all %}
                             <p class="single-name">Ca sĩ: <span>{{ item.SingerName_detail }}</span></p>
                        {% endfor %}
                  {% endif %}
            </div>
        </div>
       <div class="">
              {% if list_detail_product %} <!--nội dung 1-->
                  {% csrf_token %}
                        {% for item in list_detail_product.propertycontent_set.all %}
                             {% if forloop.counter == 1 %}
                                  <p class="noidung1">{{item.content_detail }}</p>
                             {% endif %}
                        {% endfor %}
              {% endif %}
             {% if list_detail_product %} <!--nội dung 2-->
                  {% csrf_token %}
                        {% for item in list_detail_product.propertycontent_set.all %}
                             {% if forloop.counter == 2 %}
                                  <p class="noidung2">{{item.content_detail }}</p>
                             {% endif %}
                        {% endfor %}
             {% endif %}


        <div class="row both_img">
            <div class="col">
                  {% if list_detail_product %}
                  {% csrf_token %}
                      <ul>
                        {% for item in list_detail_product.propertyimage_set.all %}
                             {% if forloop.counter == 2 %}
                                 <img class="img_part2 img-fluid rounded" src="{{ item.product_img_detail.url }}" alt="{{item.id}}">
                             {% endif %}
                        {% endfor %}
                      </ul>
                  {% endif %}

            </div>
            <div class="col">
                 {% if list_detail_product %}
                  {% csrf_token %}
                      <ul>
                        {% for item in list_detail_product.propertyimage_set.all %}
                             {% if forloop.counter == 3%}
                                 <img class="img_part2 img-fluid rounded" src="{{ item.product_img_detail.url }}" alt="{{item.id}}">
                             {% endif %}
                        {% endfor %}
                      </ul>
                  {% endif %}
            </div>
        </div>

           {% if list_detail_product %} <!--nội dung 3-->
                  {% csrf_token %}
                        {% for item in list_detail_product.propertycontent_set.all %}
                             {% if forloop.counter == 3 %}
                                  <p class="noidung3 mt-3">{{item.content_detail }}</p>
                             {% endif %}
                        {% endfor %}
             {% endif %}

        <div class="third">
            {% if list_detail_product %}
                  {% csrf_token %}
                      <ul>
                        {% for item in list_detail_product.propertyimage_set.all %}
                             {% if forloop.counter == 4%}
                                 <img class="img_trangchu img-fluid rounded" src="{{ item.product_img_detail.url }}" alt="{{item.id}}">
                             {% endif %}
                        {% endfor %}
                      </ul>
                  {% endif %}
        </div>

           {% if list_detail_product %} <!--nội dung 4 -->
                  {% csrf_token %}
                        {% for item in list_detail_product.propertycontent_set.all %}
                             {% if forloop.counter == 4 %}
                                  <p class="noidung4 mt-3">{{item.content_detail }}</p>
                             {% endif %}
                        {% endfor %}
             {% endif %}

            <div class="">
            {% if list_detail_product %}
                  {% csrf_token %}
                      <ul>
                        {% for item in list_detail_product.propertyimage_set.all %}
                             {% if forloop.counter == 5%}
                                 <img class="rounded img_trangchu img-fluid" src="{{ item.product_img_detail.url }}" alt="{{item.id}}">
                             {% endif %}
                        {% endfor %}
                      </ul>
                  {% endif %}
        </div>
             {% if list_detail_product %} <!--nội dung 5 -->
                  {% csrf_token %}
                        {% for item in list_detail_product.propertycontent_set.all %}
                             {% if forloop.counter == 5 %}
                                  <p class="noidung4 mt-3">{{item.content_detail }}</p>
                             {% endif %}
                        {% endfor %}
             {% endif %}

             <div class="link_youtobe">
               {% if list_detail_product %}
                  {% csrf_token %}
                     {% for item in list_detail_product.propertylinkyoutobe_set.all %}
                         <iframe class="rounded" width="560" height="315" src="{{item.linkSource}}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                      {% endfor %}
              {% endif %}
           </div>

             <div class="time_up mt-3">
                   {% if list_detail_product %}
                   {% csrf_token %}
                        {% for item in list_detail_product.propertytime_set.all %}

                           <p style="float:right; margin-right:20px;">Được upload vào ngày:<span>{{ item.timeDetail }}</span></p>
                        <!-- Phần share facebook -->
<!--                   <div id="fb-root"></div>-->
<!--                          <script>(function(d, s, id) {-->
<!--                            var js, fjs = d.getElementsByTagName(s)[0];-->
<!--                            if (d.getElementById(id)) return;-->
<!--                            js = d.createElement(s); js.id = id;-->
<!--                            js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0";-->
<!--                            fjs.parentNode.insertBefore(js, fjs);-->
<!--                          }(document, 'script', 'facebook-jssdk'));</script>-->

                <div class="fb-share-button " data-href="https://m-view.herokuapp.com/" data-layout="button_count" data-size="large"><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fm-view.herokuapp.com%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Chia sẻ</a>
                </div>
                 <div class="btn_share_fb_twiter ">
                        <!-- Your share button code -->
<!--                          <div class="fb-share-button"-->
<!--                                data-size="large"-->
<!--                                data-href="{{ request.build_absolute_uri }} "-->
<!--                                data-layout="button_count">-->
<!--                          </div>-->
                        <!-- Hết phần share facebook -->

                        <!-- Phần share twitter -->
                            <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                        <!-- Hết Phần share twitter -->
                 </div>

                        <!-- Nút like -->
                           <div class="HandleBtn_Like">
                               <div class="">
                                       {% if user.is_authenticated %}
                                {% if like == 1 %}
                                    <form action="{%  url 'polls:product_like' item.pk %}" method="POST">
                                        {%csrf_token%}
                                        <button type="submit", name="product_id", value="{{item.id}}", class="btn btn-primary btn-sm">Like</button>

                                    </form>
                                {% endif %}
                                {% if like == 0 %}
                                    <form action="{%  url 'polls:product_like' item.pk %}" method="POST">
                                        {%csrf_token%}
                                        <button type="submit", name="product_id", value="{{item.id}}", class="btn btn-danger btn-sm">Dislike</button>

                                    </form>
                                {% endif%}
                            {% endif %}
                        <!-- Hết nút like -->
                               </div>
                                 <p class="ml-2 mt-1"> Lượt Like {{ total_like }}</p>
                           </div>
                        {% endfor %}
                  {% endif %}

                   <a style ="float:right;"id="back_btn"class="back_famous"href="{% url 'polls:index' %}"><i class="fas fa-caret-left"></i> Trở lại </a>

             </div>

       </div>


    </div>
 <!---------------------Phần Bình luận----------------------->
<div class="container">
 <h4 class="mb-3 h4_comment">Mục bình luận</h4>
        {% if user.last_name %} <!--Xác thực xem có phải là user thì mới cho phép comment -->
            <form  action="{% url 'polls:detail' list_detail_product.id  %}"  method="POST">
                <p><strong>{{user.last_name}} {{ user.first_name }}</strong> - <lable>hãy để lại bình luận:</lable></p>
                 {% csrf_token %}
                {{ formComentProduct.body}}
                <br>
                 <input style="float:right;margin-top:-20px;" class="btn btn-success" type="submit" value="Bình luận">
            </form>
        {% else %}
            <form  action="{% url 'polls:detail' list_detail_product.id  %}"  method="POST">
                <p><strong>{{user.username}}</strong> - <lable>hãy để lại bình luận:</lable></p>
                 {% csrf_token %}
                {{ formComentProduct.body}}
                <br>
                 <input style="float:right;margin-top:-20px;" class="btn btn-success" type="submit" value="Bình luận">
            </form>
        {% endif %}
        <hr style="background-color:#5dc269;  clear:both; margin-top:30px;" >
 {% for comment in comments %} <!-- duyệt vòng vặp để in ra hết tất cả comment-->
        {% if comment.author.last_name %}
              <p><strong>{{ comment.author.last_name}} {{ comment.author.first_name}}</strong> - <label style="color:gray;">{{ comment.date}}</label></p>
        {% else %}
                  <p><strong>{{ comment.author}}</strong> - <label style="color:gray;">{{ comment.date}}</label></p>

        {% endif %}
    <div class="row">
                 <div class="col">
                        <p>{{ comment.body}}</p>
                 </div>
                 <div class="col-3">
                     {% if comment.author == request.user  %} <!-- kiểm tra xem có đúng là user đang đăng nhập vào thì mới có chức năng xóa,sửa cho bình luận đó -->
                        <div class="edit_and_remove">
                            <a href="{%url 'polls:edit_comment' comment.id list_detail_product.id   %}"><i style="color:#ADB0B3;"class="fas fa-pencil-alt"></i></a>
                            <a href="{%url 'polls:post-delete' list_detail_product.id comment.id %}"><i style="color:#ADB0B3;"class="fas fa-trash-alt"></i></a>
                        </div>
                     {%  endif %}
                 </div>

             </div>
            {% if comment.replies.count >= 0 %} <!-- Đếm số reply bình luận trong 1 bình luận -->
              <p class="luotphanhoi">lượt phản hồi: {{ comment.replies.count}} bình luận |  <a  style="color:#247c38; font-weight:600;"class="comment-reply-btn"href="#">Phản hồi</a> </p>
            {% endif %}


             <div class="Reply_Comment ml-5" >
                  {% for reply in comment.replies.all %}<!-- duyệt vòng vặp để in ra hết tất cả Reply comment-->
                  <div class="reply_item" style="background-color:#F3F4F4; border-radius:10px;">
                      <div class=" ml-3 mr-2" style="padding-top:8px;">
                          {% if reply.author.last_name %}
                           <p class="info">Đã trả lời: <strong>{{ reply.author.last_name  }} {{ reply.author.first_name  }}</strong> - <lable style="color:gray;">{{ reply.date }}</lable></p>
                        {% else %}
                          <p class="info">Đã trả lời: <strong>{{ reply.author}}</strong> - <lable style="color:gray;">{{ reply.date }}</lable></p>
                        {% endif %}
                          <div class="row">
                         <div class="col">
                               <p>{{ reply.body }}</p>
                         </div>
                         <div class="col-4">
                             {% if reply.author == request.user  %} <!-- kiểm tra xem có đúng là user đang đăng nhập vào thì mới có chức năng xóa,sửa cho bình luận đó -->
                                <div class="edit_and_remove">
                                     <a href="{%url 'polls:edit_comment' reply.id list_detail_product.id   %}"><i style="color:#ADB0B3;" class="fas fa-pencil-alt"></i></a>
                                    <a href="{%url 'polls:post-delete' list_detail_product.id reply.id %}"><i style="color:#ADB0B3;"class="fas fa-trash-alt"></i></a>
                                </div>
                             {%  endif %}
                         </div>
                     </div>
                      </div>
                  </div>
                 <br>
                  {% endfor %}
                  <div class="ml-5">
               <p style="color:#247c38; font-weight:600;">Phản hồi bình luận</p>
         {% if  request.user.is_authenticated  %} <!--Phải đăng nhập mới cho phép phản hồi bình luận-->
            <form action="{% url 'polls:detail' list_detail_product.id  %}" method="post">
                {{ formComentProduct.body }}
                {% csrf_token %}
                <!-- Hidden input for parent comment.id -->
                <input type="hidden" name="parent_id" value="{{ comment.id }}">
                <input style="float:right;margin-top:5px; margin-bottom:10px;"class="btn btn-success" type="submit" value="Phản hồi">
            </form>
        {%  endif %}
          </div>

             </div>

        <hr style="clear:both;" >
        {% empty %}
            <p>Chưa có bình luận nào :(</p>
        {% endfor %}
</div>
 <!-------------End--------Phần Bình luận----------------------->
	<!--End Main Content-->
{% for t in list_data_search %}
     <p class="list">{{t}}</p>
{% endfor %}
{% endblock %}





























